# databricks.yml
bundle:
  name: amaldatabricks
  uuid: 98bee946-7642-4fd2-beb9-d89c27ed0c2c


include:
  - resources/**/*.yml
  - resources/*.yml
  # Note: Not including config/*.yml - all configuration is in this file

# sync:
#   exclude:
#     - resources/SharedObjects/*.yml
# Note: Commented out to allow SharedObjects (clusters, warehouses, policies) to be deployed

artifacts:
  notebooks:
    files:
      - source: DataPlatform/**/*.py

# Bundle-level variable declarations (required for validation)
variables:
  catalog_name:
    description: "Unity Catalog name"
  key_vault_scope:
    description: "Azure Key Vault scope name"
  logger_directory:
    description: "Logger directory path in Unity Catalog volumes"
  axiom_archive:
    description: "Axiom archive storage path (ABFSS)"
  axiom_input:
    description: "Axiom input storage path (ABFSS)"
  axiom_volume:
    description: "Axiom volume path in Unity Catalog"
  email_notifications:
    description: "Email address for job notifications"
  git_branch:
    description: "Git branch name"

targets:
  DEV:
    mode: development  # Changed from 'production' to 'development' for DEV environment
    default: true

    run_as:
      service_principal_name: a7923e63-e14c-4c32-87cc-e89e3b4a165a

    presets:
      source_linked_deployment: false
      name_prefix: '[${workspace.current_user.short_name}]'
      tags:
        amal_owner: DataEngineering
        Environment: Dev

    variables:
      # Unity Catalog configuration
      catalog_name:
        default: ab_dev_catalog

      # Azure Key Vault configuration
      key_vault_scope:
        default: kv-az-dbricks-dev-001

      # Logger configuration
      logger_directory:
        default: /Volumes/ab_dev_catalog/config/logger
      
      git_branch:
        default: dev

      # Axiom storage paths
      axiom_archive:
        default: abfss://dev-external-location@stgazdbricksdev001.dfs.core.windows.net/archive/axiom/
      axiom_input:
        default: abfss://dev-external-location@stgazdbricksdev001.dfs.core.windows.net/input/axiom/
      axiom_volume:
        default: /Volumes/ab_dev_catalog/config/axiom/

      # Notification configuration
      email_notifications:
        default: pandi.anbu@zeb.co

    workspace:
      host: https://adb-201068313543333.13.azuredatabricks.net
      root_path: ~/.bundle/${bundle.name}/${bundle.target}

    permissions:
      - group_name: DataEngineering
        level: CAN_MANAGE
      - group_name: DataEngineering-Contractors
        level: CAN_MANAGE

  uat:
    mode: production

    run_as:
      service_principal_name: a7923e63-e14c-4c32-87cc-e89e3b4a165a

    presets:
      source_linked_deployment: false
      tags:
        amal_owner: DataEngineering
        Environment: uat

    variables:
      # Unity Catalog configuration
      catalog_name:
        default: ab_uat_catalog

      # Azure Key Vault configuration
      key_vault_scope:
        default: kv-az-dbricks-uat-001

      # Logger configuration
      logger_directory:
        default: /Volumes/ab_uat_catalog/config/logger

      # Axiom storage paths
      axiom_archive:
        default: abfss://uat-external-location@stgazdbricksdev001.dfs.core.windows.net/archive/axiom/
      axiom_input:
        default: abfss://uat-external-location@stgazdbricksdev001.dfs.core.windows.net/input/axiom/
      axiom_volume:
        default: /Volumes/ab_uat_catalog/config/axiom/

      # Notification configuration
      email_notifications:
        default: pandi.anbu@zeb.co

      # Git branch
      git_branch:
        default: uat

    workspace:
      host: https://adb-201068313543333.13.azuredatabricks.net
      root_path: /Workspace/${bundle.target}

    permissions:
      - group_name: DataEngineering
        level: CAN_MANAGE
      - group_name: DataEngineering-Contractors
        level: CAN_MANAGE

  PROD:
    mode: production

    run_as:
      service_principal_name: a7923e63-e14c-4c32-87cc-e89e3b4a165a

    presets:
      tags:
        amal_owner: DataEngineering
        Environment: Prod

    variables:
      # Unity Catalog configuration
      catalog_name:
        default: ab_prod_catalog

      # Azure Key Vault configuration
      key_vault_scope:
        default: kv-az-dbricks-prod-001

      # Logger configuration
      logger_directory:
        default: /Volumes/ab_prod_catalog/config/logger

      # Axiom storage paths
      axiom_archive:
        default: abfss://prod-external-location@stgazdbricksprod001.dfs.core.windows.net/archive/axiom/
      axiom_input:
        default: abfss://prod-external-location@stgazdbricksprod001.dfs.core.windows.net/input/axiom/
      axiom_volume:
        default: /Volumes/ab_prod_catalog/config/axiom/
      
      git_branch:
        default: main

      # Notification configuration
      email_notifications:
        default: pandi.anbu@zeb.co

    workspace:
      host: https://adb-201068313543333.13.azuredatabricks.net
      root_path: /Workspace/${bundle.target}

    permissions:
      - user_name: a7923e63-e14c-4c32-87cc-e89e3b4a165a
        level: CAN_MANAGE
